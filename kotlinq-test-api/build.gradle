buildscript {

  ext.generationTarget = "$name/src/generated/kotlin"

  repositories {
    mavenCentral()
    jcenter()
    maven {
      url 'repo'
    }
  }
  dependencies {
    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.2.0"
    classpath "com.prestongarno.kotlinq:kotlinq-gradle:1.0"
  }
}
apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'com.prestongarno.kotlinq'

tasks.findByName("compileGraphQL").mustRunAfter("compileJava")

repositories {
  mavenCentral()
  jcenter()
  flatDir {
    dirs['repo']
  }
}

dependencies {
  compile ":kotlinq-core:1.0" // workaround since gradle plugin only added by jar
  compile "org.jetbrains.kotlin:kotlin-stdlib-jre8:1.2.0"
  compile "org.jetbrains.kotlin:kotlin-reflect:1.2.0"
}

artifacts {
  archives jar
}

sourceSets {
  main {
    java {
      srcDirs = ['src/main/kotlin',
                 generationTarget]
    }
    resources {
      srcDirs = ['src/main/resources']
    }
  }
}

kotlinq {
  schema {
    target = "$project.name/src/main/resources/programmingLanguages.graphqls"
    kotlinFileName = "LanguagesGraphQL.kt"
    packageName = "com.prestongarno.kotlinq.generated.languages"
    outputDir = generationTarget + "/lang"
  }
}


projects.each {
  def foo = System.properties.getProperty("java.class.path").split(":")
  foo.collect().forEach { s ->
    println(s)
  }
}
